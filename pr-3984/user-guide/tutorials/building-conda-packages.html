

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Building conda packages &mdash; conda-build 3.19.3+96.gcdb2a39.dirty documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/conda-logo.png"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Building conda packages with conda skeleton" href="build-pkgs-skeleton.html" />
    <link rel="prev" title="Tutorials" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> conda-build
          

          
          </a>

          
            
            
              <div class="version">
                3.19.3+96.gcdb2a39.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install-conda-build.html">Installing and updating conda-build</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/index.html">Concepts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html">Getting started</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Building conda packages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#who-is-this-for">Who is this for?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#before-you-start">Before you start</a></li>
<li class="toctree-l4"><a class="reference internal" href="#toolkit">Toolkit</a></li>
<li class="toctree-l4"><a class="reference internal" href="#developing-a-build-strategy">Developing a build strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-with-a-python-version-different-from-your-miniconda-installation">Building with a Python version different from your Miniconda installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#automated-testing">Automated testing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-a-sep-package-with-conda-and-python-2-or-3">Building a SEP package with conda and Python 2 or 3</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-a-gdal-package-with-conda-and-python-2-or-3">Building a GDAL package with conda and Python 2 or 3</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="build-pkgs-skeleton.html">Building conda packages with conda skeleton</a></li>
<li class="toctree-l3"><a class="reference internal" href="build-pkgs.html">Building conda packages from scratch</a></li>
<li class="toctree-l3"><a class="reference internal" href="build-r-pkgs.html">Building R packages with skeleton CRAN</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../recipes/index.html">Recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../environment-variables.html">Environment variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wheel-files.html">Using wheel files with conda</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../resources/index.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes.html">Release notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">conda-build</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">User guide</a> &raquo;</li>
        
          <li><a href="index.html">Tutorials</a> &raquo;</li>
        
      <li>Building conda packages</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="building-conda-packages">
<h1>Building conda packages<a class="headerlink" href="#building-conda-packages" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id2">Overview</a></li>
<li><a class="reference internal" href="#who-is-this-for" id="id3">Who is this for?</a></li>
<li><a class="reference internal" href="#before-you-start" id="id4">Before you start</a></li>
<li><a class="reference internal" href="#toolkit" id="id5">Toolkit</a></li>
<li><a class="reference internal" href="#developing-a-build-strategy" id="id6">Developing a build strategy</a></li>
<li><a class="reference internal" href="#building-with-a-python-version-different-from-your-miniconda-installation" id="id7">Building with a Python version different from your Miniconda installation</a></li>
<li><a class="reference internal" href="#automated-testing" id="id8">Automated testing</a></li>
<li><a class="reference internal" href="#building-a-sep-package-with-conda-and-python-2-or-3" id="id9">Building a SEP package with conda and Python 2 or 3</a></li>
<li><a class="reference internal" href="#building-a-gdal-package-with-conda-and-python-2-or-3" id="id10">Building a GDAL package with conda and Python 2 or 3</a></li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id2">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This tutorial describes how to use conda-build to create conda
packages on Windows, macOS, and Linux using the examples of
SEP and GDAL. Additional Windows-specific instructions are provided in the
<a class="reference internal" href="#toolkit"><span class="std std-ref">Toolkit</span></a> section.</p>
<p>The final built packages from this tutorial are available on
<a class="reference external" href="https://anaconda.org">Anaconda Cloud</a>:</p>
<ul class="simple">
<li><a class="reference external" href="https://anaconda.org/wwarner/sep/files">SEP</a>.</li>
<li><a class="reference external" href="https://anaconda.org/conda-forge/gdal/files">GDAL</a>.</li>
</ul>
<p>This tutorial also describes writing recipes. You can see the
final <a class="reference external" href="https://github.com/conda-forge/sep-feedstock">SEP recipe</a>
and the <a class="reference external" href="https://github.com/conda-forge/gdal-feedstock">GDAL recipe</a>
on GitHub in the <a class="reference external" href="https://github.com/conda/conda-build/tree/master/docs">conda-build documentation repository</a>.</p>
</div>
<div class="section" id="who-is-this-for">
<h2><a class="toc-backref" href="#id3">Who is this for?</a><a class="headerlink" href="#who-is-this-for" title="Permalink to this headline">¶</a></h2>
<p>This tutorial is for Windows, macOS, and Linux users who wish to
build more complex conda packages. This tutorial will involve building
scientific packages, which require compilers for several different
Python versions.</p>
</div>
<div class="section" id="before-you-start">
<span id="before-you-start4"></span><h2><a class="toc-backref" href="#id4">Before you start</a><a class="headerlink" href="#before-you-start" title="Permalink to this headline">¶</a></h2>
<p>Before you start, make sure you have installed:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="https://conda.io/projects/conda/en/latest/user-guide/install/index.html">Conda</a>.</li>
<li><a class="reference internal" href="../../install-conda-build.html#install-conda-build"><span class="std std-ref">Conda-build</span></a>.</li>
<li>Any compilers you want.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="toolkit">
<span id="id1"></span><h2><a class="toc-backref" href="#id5">Toolkit</a><a class="headerlink" href="#toolkit" title="Permalink to this headline">¶</a></h2>
<div class="section" id="microsoft-visual-studio">
<h3>Microsoft Visual Studio<a class="headerlink" href="#microsoft-visual-studio" title="Permalink to this headline">¶</a></h3>
<p>In the standard practices of the conda developers, conda packages
for different versions of Python are each built with their own
version of Visual Studio (VS):</p>
<ul class="simple">
<li>Python 2.7 packages with Visual Studio 2008</li>
<li>Python 3.4 packages with VS 2010</li>
<li>Python 3.5 packages with VS 2015, (default) 2017</li>
<li>Python 3.6 packages with VS 2015, (default) 2017</li>
<li>Python 3.7 packages with VS 2015, (default) 2017</li>
</ul>
<p>Using these versions of VS to build packages for each of these
versions of Python is also the practice used for the official
python.org builds of Python. Currently VS 2008 and VS 2010 are
available only through resellers, while VS 2015 and VS 2017 can
be purchased online from Microsoft. Note there is also a community
edition of VS 2015 and VS 2017 which may be used.</p>
</div>
<div class="section" id="alternatives-to-microsoft-visual-studio">
<h3>Alternatives to Microsoft Visual Studio<a class="headerlink" href="#alternatives-to-microsoft-visual-studio" title="Permalink to this headline">¶</a></h3>
<p>There are free alternatives available for each version of the VS
compilers:</p>
<ul class="simple">
<li>Instead of VS 2008, it is often possible to substitute the
<a class="reference external" href="https://www.microsoft.com/en-us/download/details.aspx?id=44266">free Microsoft Visual C++ Compiler for Python 2.7</a>.</li>
<li>Instead of VS 2010, it is often possible to substitute the
<a class="reference external" href="https://www.microsoft.com/en-us/download/details.aspx?id=8279">free Microsoft Windows SDK for Windows 7 and .NET Framework 4</a>.</li>
<li>Make sure that you also install <a class="reference external" href="https://www.microsoft.com/en-us/download/details.aspx?id=34677">VS 2010 Service Pack 1 (SP1)</a>.</li>
<li>Due to a bug in the VS 2010 SP1 installer, the compiler tools
may be removed during installation of VS 2010 SP1. They can be
restored as described in <a class="reference external" href="https://www.microsoft.com/en-us/download/details.aspx?id=4422">Microsoft Visual C++ 2010 Service
Pack 1 Compiler Update for the Windows SDK 7.1</a>.</li>
<li>Visual Studio 2015 has a full-featured, free <a class="reference external" href="https://www.visualstudio.com/en-us/products/visual-studio-community-vs.aspx">Community edition</a>
for academic research, open source projects, and certain other
use cases.</li>
</ul>
<p>The MS Visual C++ Compiler for Python 2.7 and the Microsoft
Windows SDK for Windows 7 and .NET Framework 4 are both
reasonably well tested. Conda-build is carefully tested to
support these configurations, but there are known issues with the
CMake build tool and these free VS 2008 and 2010 alternatives.
In these cases, you should prefer the &quot;NMake Makefile&quot; generator,
rather than a Visual Studio solution generator.</p>
</div>
<div class="section" id="windows-versions">
<h3>Windows versions<a class="headerlink" href="#windows-versions" title="Permalink to this headline">¶</a></h3>
<p>You can use any recent version of Windows. These examples were
built on Windows 10.</p>
</div>
<div class="section" id="other-tools">
<h3>Other tools<a class="headerlink" href="#other-tools" title="Permalink to this headline">¶</a></h3>
<p>Some environments initially lack tools such as patch or Git
that may be needed for some build workflows.</p>
<p>On Windows, these can be installed with conda:</p>
<p><code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">git</span> <span class="pre">m2-patch</span></code></p>
<p>On macOS and Linux, replace <code class="docutils literal notranslate"><span class="pre">m2-patch</span></code> with patch.</p>
</div>
</div>
<div class="section" id="developing-a-build-strategy">
<h2><a class="toc-backref" href="#id6">Developing a build strategy</a><a class="headerlink" href="#developing-a-build-strategy" title="Permalink to this headline">¶</a></h2>
<p>Conda recipes are typically built with a trial-and-error method.
Often the first attempt to build a package fails with compiler
or linker errors, often caused by missing dependencies. The person
writing the recipe then examines these errors and modifies the
recipe to include the missing dependencies, usually as part of the
<code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code> file. Then the recipe writer attempts the build
again and, after a few of these cycles of trial and error, the
package builds successfully.</p>
</div>
<div class="section" id="building-with-a-python-version-different-from-your-miniconda-installation">
<h2><a class="toc-backref" href="#id7">Building with a Python version different from your Miniconda installation</a><a class="headerlink" href="#building-with-a-python-version-different-from-your-miniconda-installation" title="Permalink to this headline">¶</a></h2>
<p>Miniconda2 and Miniconda3 can each build packages for either
Python 2 or Python 3 simply by specifying the version you want.
Miniconda2 includes only Python 2 and Miniconda3 includes only
Python 3.</p>
<p>Installing only one makes it easier to keep track of
the builds, but it is possible to have both installed on the same
system at the same time. If you have both installed, use the
<code class="docutils literal notranslate"><span class="pre">where</span></code> command on Windows, or <code class="docutils literal notranslate"><span class="pre">which</span></code> command on Linux to
see which version comes first on PATH since this is the one you will be using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">where</span> <span class="n">python</span>
</pre></div>
</div>
<p>To build a package for a Python version other than the one in
your Miniconda installation, use the <code class="docutils literal notranslate"><span class="pre">--python</span></code> option in the
<code class="docutils literal notranslate"><span class="pre">conda-build</span></code> command.</p>
<p>EXAMPLE: To build a Python 3.5 package with Miniconda2:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span><span class="o">-</span><span class="n">build</span> <span class="n">recipeDirectory</span> <span class="o">--</span><span class="n">python</span><span class="o">=</span><span class="mf">3.5</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Replace <code class="docutils literal notranslate"><span class="pre">recipeDirectory</span></code> with the name and path of your
recipe directory.</p>
</div>
</div>
<div class="section" id="automated-testing">
<h2><a class="toc-backref" href="#id8">Automated testing</a><a class="headerlink" href="#automated-testing" title="Permalink to this headline">¶</a></h2>
<p>After the build, if the recipe directory contains a test file. This test
file is named <code class="docutils literal notranslate"><span class="pre">run_test.bat</span></code> on Windows, <code class="docutils literal notranslate"><span class="pre">run_test.sh</span></code> on macOS or Linux,
or <code class="docutils literal notranslate"><span class="pre">run_test.py</span></code> on any platform. The file runs to test the package
and any errors are reported. After seeing &quot;check the output,&quot; you can
also test if this package was built by using the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ conda build --test &lt;path to package&gt;.tar.bz2
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use the <a class="reference internal" href="../../resources/define-metadata.html#meta-test"><span class="std std-ref">Test section of the meta.yaml file</span></a> to move data files from the recipe directory to the
test directory when the test is run.</p>
</div>
</div>
<div class="section" id="building-a-sep-package-with-conda-and-python-2-or-3">
<h2><a class="toc-backref" href="#id9">Building a SEP package with conda and Python 2 or 3</a><a class="headerlink" href="#building-a-sep-package-with-conda-and-python-2-or-3" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://sep.readthedocs.io">SEP documentation</a> states
that SEP runs on Python 2 and 3, and it depends only on NumPy.
Searching for SEP and PyPI shows that there is already <a class="reference external" href="https://pypi.python.org/pypi/sep">a PyPI
package for SEP</a>.</p>
<p>Because a PyPI package for SEP already exists, the
<code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">skeleton</span></code> command can make a skeleton or outline of a
conda recipe based on the PyPI package. Then the recipe outline
can be completed manually and conda can build a conda package
from the completed recipe.</p>
<div class="section" id="install-visual-studio">
<h3>Install Visual Studio<a class="headerlink" href="#install-visual-studio" title="Permalink to this headline">¶</a></h3>
<p>If you have not already done so, install the appropriate
version of Visual Studio:</p>
<ul class="simple">
<li>For Python 3---Visual Studio 2017:<ol class="arabic">
<li>Choose Custom install.</li>
<li>Under Programming Languages, choose to install Visual C++.</li>
</ol>
</li>
<li>For Python 2---Visual Studio 2008:<ol class="arabic">
<li>Choose Custom install.</li>
<li>Choose to install X64 Compilers and Tools. Install Service Pack 1.</li>
</ol>
</li>
</ul>
</div>
<div class="section" id="make-a-conda-skeleton-recipe">
<h3>Make a conda skeleton recipe<a class="headerlink" href="#make-a-conda-skeleton-recipe" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Run the skeleton command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">skeleton</span> <span class="n">pypi</span> <span class="n">sep</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">skeleton</span></code> command installs into a newly created
directory called <code class="docutils literal notranslate"><span class="pre">sep</span></code>.</p>
</li>
<li><p class="first">Go to the <code class="docutils literal notranslate"><span class="pre">sep</span></code> directory to view the files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">sep</span>
</pre></div>
</div>
<p>One skeleton file has been created: <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code></p>
</li>
</ol>
</div>
<div class="section" id="edit-the-skeleton-files">
<h3>Edit the skeleton files<a class="headerlink" href="#edit-the-skeleton-files" title="Permalink to this headline">¶</a></h3>
<p>For this package, <code class="docutils literal notranslate"><span class="pre">bld.bat</span></code> and <code class="docutils literal notranslate"><span class="pre">build.sh</span></code> need no changes.
You need to edit the <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code> file to add the dependency on
NumPy and add an optional test for the built package by importing
it. For more information about what can be specified in <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code>,
see <a class="reference internal" href="../../resources/define-metadata.html"><span class="doc">Defining metadata (meta.yaml)</span></a>.</p>
<ol class="arabic simple">
<li>In the requirements section of the <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code> file, add a
line that adds NumPy as a requirement to build the package.</li>
<li>Add a second line to list NumPy as a requirement to run the
package.</li>
<li>Set the NumPy version to the letters <code class="docutils literal notranslate"><span class="pre">x.x</span></code>.</li>
<li>Make sure the new line is aligned with <code class="docutils literal notranslate"><span class="pre">-</span> <span class="pre">python</span></code> on the
line above it, so as to ensure proper yaml format.</li>
</ol>
<p>EXAMPLE:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">requirements</span><span class="p">:</span>
  <span class="nt">host</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">numpy     x.x</span>

  <span class="nt">run</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">numpy     x.x</span>
</pre></div>
</div>
<p>Notice that there are two types of requirements, host and run.
Host represents packages that need to be specific to the target
platform when the target platform is not necessarily the same as
the native build platform. Run represents the dependencies that
should be installed when the package is installed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Using the letters <code class="docutils literal notranslate"><span class="pre">x.x</span></code> instead of a specific version
such as <code class="docutils literal notranslate"><span class="pre">1.11</span></code> pins NumPy dynamically, so that the actual
version of NumPy is taken from the build command. Currently, NumPy
is the only package that can be pinned dynamically. Pinning is
important for SEP because this package uses NumPy's C API through
Cython. That API changes between NumPy versions, so it is
important to use the same NumPy version at runtime that was used
at build time.</p>
</div>
<div class="section" id="optional-add-a-test-for-the-built-package">
<h4>OPTIONAL: Add a test for the built package<a class="headerlink" href="#optional-add-a-test-for-the-built-package" title="Permalink to this headline">¶</a></h4>
<p>Adding this optional test will test the package at the end of the
build by making sure that the Python statement <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">sep</span></code>
runs successfully:</p>
<ol class="arabic">
<li><p class="first">Add <code class="docutils literal notranslate"><span class="pre">-</span> <span class="pre">sep</span></code>, checking to be sure that the indentation is
consistent with the rest of the file.</p>
<p>EXAMPLE:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">test</span><span class="p">:</span>
  <span class="c1"># Python imports</span>
  <span class="nt">imports</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">sep</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="build-the-package">
<h3>Build the package<a class="headerlink" href="#build-the-package" title="Permalink to this headline">¶</a></h3>
<p>Build the package using the recipe you just created:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">build</span> <span class="n">sep</span>
</pre></div>
</div>
</div>
<div class="section" id="check-the-output">
<h3>Check the output<a class="headerlink" href="#check-the-output" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Check the output to make sure that the build completed
successfully. The output contains the location of the final
package file and a command to upload the package to Anaconda
Cloud. The output will look something like:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Automatic uploading is disabled</span>
<span class="c1"># If you want to upload package(s) to anaconda.org later, type:</span>
<span class="l l-Scalar l-Scalar-Plain">anaconda upload /Users/builder/miniconda3/conda-bld/osx-64/sep-1.0.3-np111py36_0.tar.bz2</span>
<span class="l l-Scalar l-Scalar-Plain"># To have conda build upload to anaconda.org automatically, use</span>
<span class="l l-Scalar l-Scalar-Plain"># $ conda config --set anaconda_upload yes</span>
<span class="l l-Scalar l-Scalar-Plain">anaconda_upload is not set.  Not uploading wheels</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[]</span>
<span class="c1">####################################################################################</span>
<span class="nt">Resource usage summary</span><span class="p">:</span>
<span class="nt">Total time</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0:00:56.4</span>
<span class="nt">CPU usage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sys=0:00:00.7, user=0:00:07.0</span>
<span class="nt">Maximum memory usage observed</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">220.1M</span>
<span class="nt">Total disk usage observed (not including envs)</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3.9K</span>
<span class="c1">####################################################################################</span>
<span class="l l-Scalar l-Scalar-Plain">Source and build intermediates have been left in /Users/builder/miniconda3/conda-bld.</span>
<span class="l l-Scalar l-Scalar-Plain">There are currently 437 accumulated.</span>
<span class="l l-Scalar l-Scalar-Plain">To remove them, you can run the ```conda build purge``` command</span>
</pre></div>
</div>
</li>
</ol>
<ol class="arabic simple" start="2">
<li>If there are any linker or compiler errors, modify the recipe
and build again.</li>
</ol>
</div>
</div>
<div class="section" id="building-a-gdal-package-with-conda-and-python-2-or-3">
<h2><a class="toc-backref" href="#id10">Building a GDAL package with conda and Python 2 or 3</a><a class="headerlink" href="#building-a-gdal-package-with-conda-and-python-2-or-3" title="Permalink to this headline">¶</a></h2>
<p>This procedure describes how to build a package with Python 2 or Python 3.
Follow the instructions for your preferred version.</p>
<p>To begin, install Anaconda or Miniconda and conda-build. If you are using a
Windows machine, also use conda to install Git and the m2-patch.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda install git
conda install m2-patch
</pre></div>
</div>
<p>Because GDAL includes C and C++, building it on Windows requires Visual Studio.
This procedure describes how to build a package with Python 2 or
Python 3. Follow the instructions for the version with which you want
to build.</p>
<p>To build a GDAL package:</p>
<ol class="arabic">
<li><p class="first">Install Visual Studio:</p>
<ul class="simple">
<li>For Python 3, install <a class="reference external" href="https://docs.microsoft.com/en-us/visualstudio/install/install-visual-studio?view=vs-2017">Visual Studio 2017</a>.
Choose Custom install. Under Programming Languages, select workloads that
come from Visual Studio so you choose the Desktop Development with C++ and
Universal Platform C.</li>
<li>For Python 2, install <a class="reference external" href="http://download.microsoft.com/download/E/8/E/E8EEB394-7F42-4963-A2D8-29559B738298/VS2008ExpressWithSP1ENUX1504728.iso">Visual Studio 2008</a>.
Choose Custom install. Choose to install X64 Compilers and Tools.
Install Visual Studio 2008 Service Pack 1.</li>
</ul>
</li>
<li><p class="first">Install Git.
Because the GDAL package sources are retrieved from GitHub
for the build, you must install Git:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="n">git</span> <span class="n">m2</span><span class="o">-</span><span class="n">patch</span> <span class="n">conda</span><span class="o">-</span><span class="n">build</span>
</pre></div>
</div>
</li>
<li><p class="first">Get gdal-feedstock. For the purpose of this tutorial, we will be using a recipe from Anaconda:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">AnacondaRecipes</span><span class="o">/</span><span class="n">gdal</span><span class="o">-</span><span class="n">feedstock</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
</li>
<li><p class="first">Use conda-build to build the gdal-feedstock:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">build</span> <span class="n">gdal</span><span class="o">-</span><span class="n">feedstock</span>
</pre></div>
</div>
</li>
<li><p class="first">Check the output to make sure the build completed
successfully. The output also contains the location of the
final package file and a command to upload the package to
Cloud. For this package in particular, there should be two
packages outputted: libgdal and GDAL.</p>
</li>
<li><p class="first">In case of any linker or compiler errors, modify the recipe
and run it again.</p>
</li>
</ol>
<p>Let’s take a better look at what’s happening inside the gdal-feedstock.
In particular, what is happening in the <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code>.</p>
<p>The first interesting bit happens under <code class="docutils literal notranslate"><span class="pre">source</span></code> in the patches
section:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">patches</span><span class="p">:</span>
  <span class="c1"># BUILT_AS_DYNAMIC_LIB.</span>
  <span class="o">-</span> <span class="mi">0001</span><span class="o">-</span><span class="n">windowshdf5</span><span class="o">.</span><span class="n">patch</span>
  <span class="c1"># Use multiple cores on Windows.</span>
  <span class="o">-</span> <span class="mi">0002</span><span class="o">-</span><span class="n">multiprocessor</span><span class="o">.</span><span class="n">patch</span>
  <span class="c1"># disable 12 bit jpeg on Windows as we aren&#39;t using internal jpeg</span>
  <span class="o">-</span> <span class="mi">0003</span><span class="o">-</span><span class="n">disable_jpeg12</span><span class="o">.</span><span class="n">patch</span>
</pre></div>
</div>
<p>This section says that when this package is being built on a Windows
platform, apply the following patch files. Notice that the patch files
are in the <cite>patches</cite> directory of the recipe. These patches will only
be applied to Windows since the <code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">[win]</span></code> selector is applied to each
of the patch entries. For more about selectors, see
<a class="reference internal" href="../../resources/define-metadata.html#preprocess-selectors"><span class="std std-ref">Preprocessing selectors</span></a>.</p>
<p>In the requirements section, notice how there are both a build and
host set of requirements. For this recipe, all the compilers required to
build the package are listed in the build requirements.
Normally, this section will list out packages required to build the package.
GDAL requires CMake on Windows, as well as C compilers.
Notice that the C compilers are pulled into the recipe using the syntax
<code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">compiler('c')</span> <span class="pre">}}</span></code>. Since conda-build 3, conda-build defines a jinja2
function <code class="docutils literal notranslate"><span class="pre">compiler()</span></code> to specify compiler packages dynamically. So, using
the <code class="docutils literal notranslate"><span class="pre">compiler(‘c’)</span></code> function in a conda recipe will pull in the correct
compiler for any build platform. For more information about compilers with
conda-build see <a class="reference internal" href="../../resources/compiler-tools.html#compiler-tools"><span class="std std-ref">compiler-tools</span></a>.</p>
<p>Also note that the compilers used by conda-build can be specified using
a <code class="docutils literal notranslate"><span class="pre">conda_build_config.yaml</span></code>. For more information about how to do that,
see <a class="reference internal" href="../../resources/compiler-tools.html#using-your-customized-compiler-package-with-conda-build-3"><span class="std std-ref">Using your customized compiler package with conda-build 3</span></a>.</p>
<p>Notice that this package has an <code class="docutils literal notranslate"><span class="pre">outputs</span></code> section.
This section is a list of packages to output as a result of building
this package. In this case, the packages libgdal and GDAL will be built.
Similar to a normal recipe, the outputs can have build scripts,
tests scripts and requirements specified.
For more information on how outputs work, see the <a class="reference internal" href="../../resources/define-metadata.html#package-outputs"><span class="std std-ref">Outputs section</span></a>.</p>
<p>Now, let's try to build GDAL against some build matrix.
We will specify building against Python 3.7 and 3.5 using a conda-build config.
Add the following to your <code class="docutils literal notranslate"><span class="pre">conda_build_config.yaml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">python</span><span class="p">:</span>
   <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3.7</span>
   <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3.5</span>
</pre></div>
</div>
<p>Now you can build GDAL using conda-build with the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">build</span> <span class="n">gdal</span><span class="o">-</span><span class="n">feedstock</span>
</pre></div>
</div>
<p>Or explicitly set the location of the conda-build variant matrix:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">build</span> <span class="n">gdal</span><span class="o">-</span><span class="n">feedstock</span> <span class="o">--</span><span class="n">variant</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="n">file</span> <span class="n">conda_build_config</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>If you want to know more about build variants and <code class="docutils literal notranslate"><span class="pre">conda_build_config.yaml</span></code>,
including how to specify a config file and what can go into it, take a look
at <a class="reference internal" href="../../resources/variants.html#conda-build-variant-config-files"><span class="std std-ref">Creating conda-build variant config files</span></a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="build-pkgs-skeleton.html" class="btn btn-neutral float-right" title="Building conda packages with conda skeleton" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Tutorials" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Anaconda, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>