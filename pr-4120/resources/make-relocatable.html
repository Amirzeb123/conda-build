

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Making packages relocatable &mdash; conda-build 3.20.5+18.g95adf3f.dirty documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/conda-logo.png"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Conda package specification" href="package-spec.html" />
    <link rel="prev" title="Activate scripts" href="activate-scripts.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> conda-build
          

          
          </a>

          
            
            
              <div class="version">
                3.20.5+18.g95adf3f.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install-conda-build.html">Installing and updating conda-build</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/index.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/index.html">User guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Resources</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="build-scripts.html">Build scripts (build.sh, bld.bat)</a></li>
<li class="toctree-l2"><a class="reference internal" href="compiler-tools.html">Anaconda compiler tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="define-metadata.html">Defining metadata (meta.yaml)</a></li>
<li class="toctree-l2"><a class="reference internal" href="link-scripts.html">Adding pre-link, post-link, and pre-unlink scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="activate-scripts.html">Activate scripts</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Making packages relocatable</a></li>
<li class="toctree-l2"><a class="reference internal" href="package-spec.html">Conda package specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="use-shared-libraries.html">Using shared libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="variants.html">Build variants</a></li>
<li class="toctree-l2"><a class="reference internal" href="commands/index.html">Conda-build CLI reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="add-win-start-menu-items.html">Adding Windows Start menu items</a></li>
<li class="toctree-l2"><a class="reference internal" href="style-guide.html">Writing style guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial-template.html">Tutorial template</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">Release notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">conda-build</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Resources</a> &raquo;</li>
        
      <li>Making packages relocatable</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="making-packages-relocatable">
<span id="make-relocatable"></span><h1>Making packages relocatable<a class="headerlink" href="#making-packages-relocatable" title="Permalink to this headline">Â¶</a></h1>
<p>Often, the most difficult thing about building a conda package is
making it relocatable. Relocatable means that the package can be
installed into any prefix. Otherwise, the package would be usable
only in the environment in which it was built.</p>
<p>Conda-build does the following things automatically to make
packages relocatable:</p>
<ul class="simple">
<li>Binary object files are converted to use relative paths using
<code class="docutils literal notranslate"><span class="pre">install_name_tool</span></code> on macOS and patchelf on Linux.</li>
<li>Any text file without NULL bytes that contains the build prefix
or the placeholder prefix <code class="docutils literal notranslate"><span class="pre">/opt/anaconda1anaconda2anaconda3</span></code>
is registered in the <code class="docutils literal notranslate"><span class="pre">info/has_prefix</span></code> file in the package
metadata. When conda installs the package, any files in
<code class="docutils literal notranslate"><span class="pre">info/has_prefix</span></code> have the registered prefix replaced with
the install prefix. For more information, see
<a class="reference internal" href="package-spec.html#package-metadata"><span class="std std-ref">Package metadata</span></a>.</li>
<li>Any binary file containing the build prefix can automatically
be registered in <code class="docutils literal notranslate"><span class="pre">info/has_prefix</span></code> using
<code class="docutils literal notranslate"><span class="pre">build/detect_binary_files_with_prefix</span></code> in <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code>.
Alternatively, individual binary files can be registered by
listing them in <code class="docutils literal notranslate"><span class="pre">build/binary_has_prefix_files</span></code> in
<code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code>. The registered files will have their build
prefix replaced with the install prefix at install time. This
works by padding the install prefix with null terminators, such
that the length of the binary file remains the same. The build
prefix must therefore be long enough to accommodate any
reasonable installation prefix. On macOS and Linux, conda-build
pads the build prefix to 255 characters by appending
<code class="docutils literal notranslate"><span class="pre">_placehold</span></code>s to the end of the build directory name.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The prefix length was changed in conda-build 2.0 from 80
characters to 255 characters. Legacy packages with
80-character prefixes must be rebuilt to take advantage of the
longer prefix.</p>
</div>
<ul class="simple">
<li>There may be cases where conda identified a file as binary, but
it needs to have the build prefix replaced as if it were
text---no padding with null terminators. Such files can be
listed in <code class="docutils literal notranslate"><span class="pre">build/has_prefix_files</span></code> in <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code>.</li>
</ul>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="package-spec.html" class="btn btn-neutral float-right" title="Conda package specification" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="activate-scripts.html" class="btn btn-neutral float-left" title="Activate scripts" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Anaconda, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>