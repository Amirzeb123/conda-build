

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Building R packages with skeleton CRAN &mdash; conda-build 3.19.3+96.g080905e.dirty documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/conda-logo.png"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Recipes" href="../recipes/index.html" />
    <link rel="prev" title="Building conda packages from scratch" href="build-pkgs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> conda-build
          

          
          </a>

          
            
            
              <div class="version">
                3.19.3+96.g080905e.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install-conda-build.html">Installing and updating conda-build</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/index.html">Concepts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html">Getting started</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="building-conda-packages.html">Building conda packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="build-pkgs-skeleton.html">Building conda packages with conda skeleton</a></li>
<li class="toctree-l3"><a class="reference internal" href="build-pkgs.html">Building conda packages from scratch</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Building R packages with skeleton CRAN</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#who-is-this-for">Who is this for?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#before-you-start">Before you start</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-a-simple-package-with-conda-skeleton-cran">Building a simple package with conda skeleton CRAN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-an-r-package-with-dependencies">Building an R package with dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optional-building-for-a-different-r-version">Optional---Building for a different R version</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optional-uploading-packages-to-anaconda-org">Optional---Uploading packages to Anaconda.org</a></li>
<li class="toctree-l4"><a class="reference internal" href="#more-information">More information</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../recipes/index.html">Recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../environment-variables.html">Environment variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wheel-files.html">Using wheel files with conda</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../resources/index.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes.html">Release notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">conda-build</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">User guide</a> &raquo;</li>
        
          <li><a href="index.html">Tutorials</a> &raquo;</li>
        
      <li>Building R packages with skeleton CRAN</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="building-r-packages-with-skeleton-cran">
<h1>Building R packages with skeleton CRAN<a class="headerlink" href="#building-r-packages-with-skeleton-cran" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id1">Overview</a></li>
<li><a class="reference internal" href="#who-is-this-for" id="id2">Who is this for?</a></li>
<li><a class="reference internal" href="#before-you-start" id="id3">Before you start</a></li>
<li><a class="reference internal" href="#building-a-simple-package-with-conda-skeleton-cran" id="id4">Building a simple package with conda skeleton CRAN</a></li>
<li><a class="reference internal" href="#building-an-r-package-with-dependencies" id="id5">Building an R package with dependencies</a></li>
<li><a class="reference internal" href="#optional-building-for-a-different-r-version" id="id6">Optional---Building for a different R version</a></li>
<li><a class="reference internal" href="#optional-uploading-packages-to-anaconda-org" id="id7">Optional---Uploading packages to Anaconda.org</a></li>
<li><a class="reference internal" href="#more-information" id="id8">More information</a></li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id1">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This tutorial describes how to quickly build
an R-language package on macOS for an R module
that is already available on CRAN.</p>
<p>You will build a simple package that can be
installed in any conda environment of the same
R version as your root environment. The tutorial
will also tell you how to build the dependencies
that may arise while building the package.</p>
</div>
<div class="section" id="who-is-this-for">
<h2><a class="toc-backref" href="#id2">Who is this for?</a><a class="headerlink" href="#who-is-this-for" title="Permalink to this headline">¶</a></h2>
<p>This tutorial is for macOS users who wish to
build an R-language package from CRAN.
No prior knowledge of conda-build or conda recipes
is required.</p>
</div>
<div class="section" id="before-you-start">
<span id="before-you-start3"></span><h2><a class="toc-backref" href="#id3">Before you start</a><a class="headerlink" href="#before-you-start" title="Permalink to this headline">¶</a></h2>
<p>Before you start, check the <a class="reference internal" href="index.html"><span class="doc">prerequisites</span></a>.</p>
</div>
<div class="section" id="building-a-simple-package-with-conda-skeleton-cran">
<span id="conda-build-cran"></span><h2><a class="toc-backref" href="#id4">Building a simple package with conda skeleton CRAN</a><a class="headerlink" href="#building-a-simple-package-with-conda-skeleton-cran" title="Permalink to this headline">¶</a></h2>
<p>The conda skeleton command picks up the CRAN package
metadata and prepares the conda-build recipe. The final
step is to build the package itself and install it into
your conda environment.</p>
<p>It is easy to build a skeleton recipe for any R package that is hosted on CRAN.
In this section you are going to use conda skeleton to generate a conda recipe,
which informs conda-build about where the source files are located and how to
build and install the package.</p>
<p>You'll be working with a package that is hosted on CRAN named <a class="reference external" href="https://github.com/conda-forge/r-fansi-feedstock">fansi</a>,
a tool that accounts for the effects of ANSI text formatting control sequences.</p>
<p>First, in your user home directory, run the conda skeleton command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda skeleton cran fansi
</pre></div>
</div>
<p>The two arguments to <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">skeleton</span></code> are the type of hosting location,
in this case <code class="docutils literal notranslate"><span class="pre">cran</span></code>, and the name of the package.</p>
<p>This creates a directory named <code class="docutils literal notranslate"><span class="pre">r-fansi</span></code> and creates 1
skeleton file in that directory: <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code>. Many other files
can be added there as necessary, such as <code class="docutils literal notranslate"><span class="pre">build.sh</span></code> and <code class="docutils literal notranslate"><span class="pre">bld.bat</span></code>,
test scripts, or anything else you need to build your software.
Use the <code class="docutils literal notranslate"><span class="pre">ls</span></code> command to verify that this file has been created.
The <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code> file has been populated with information from the
CRAN metadata and in many cases will not need to be edited.</p>
<p>Files in the folder with <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code> are collectively referred to
as the &quot;conda-build recipe&quot;:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code>---Contains all the metadata in the recipe. The package name and package version sections are required---everything else is optional.</li>
<li><code class="docutils literal notranslate"><span class="pre">bld.bat</span></code>---Windows commands to build the package.</li>
<li><code class="docutils literal notranslate"><span class="pre">build.sh</span></code>---macOS and Linux commands to build the package.</li>
</ul>
<p>Now that you have the conda-build recipe ready, you can use
conda-build to create the package:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda-build r-fansi
</pre></div>
</div>
<p>When conda-build is finished, it displays the exact path and
filename of the conda package. See <a class="reference internal" href="build-pkgs-skeleton.html#troubleshooting"><span class="std std-ref">Troubleshooting a sample issue</span></a> if the
<code class="docutils literal notranslate"><span class="pre">conda-build</span></code> command fails. If you receive an error with SDK on macOS,
review our <a class="reference internal" href="../../resources/compiler-tools.html#mac-sdk"><span class="std std-ref">resources for macOS and SDK</span></a>.</p>
<p>Example file path:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>/Users/jsmith/anaconda3/conda-bld/osx-64/r-fansi-0.4.0-r353h46e59ec_0.tar.bz2
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Your path and filename will vary depending on your
installation and operating system. Save the path and
filename information for the next step.</p>
</div>
<p>Now you can install your newly built package in your
conda environment by using the use-local flag:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda install --use-local r-fansi
</pre></div>
</div>
<p>Now verify that fansi installed successfully:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda list
</pre></div>
</div>
<p>Scroll through the list until you find <code class="docutils literal notranslate"><span class="pre">r-fansi</span></code>.</p>
<p>Notice that fansi is coming from the local conda-build channel.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>base<span class="o">)</span> <span class="m">0561</span>:~ jsmith$ conda list
<span class="c1"># packages in environment at /Users/Jsmith/anaconda3:</span>
<span class="c1"># Name                    Version                   Build  Channel</span>
qtpy                      <span class="m">1</span>.5.0                    py37_0
r-base                    <span class="m">3</span>.5.1                h539fb6c_1
r-fansi                   <span class="m">0</span>.4.0            r353h46e59ec_0    <span class="nb">local</span>
</pre></div>
</div>
<p>The version of R will be what you have in your base environment.</p>
<p>See <a class="reference internal" href="#different-r-version"><span class="std std-ref">Optional---Building for a different R version</span></a> to set your own
R version.</p>
<p>At this point you now have a conda package for fansi
that can be installed in any conda environment of its
R version.</p>
</div>
<div class="section" id="building-an-r-package-with-dependencies">
<h2><a class="toc-backref" href="#id5">Building an R package with dependencies</a><a class="headerlink" href="#building-an-r-package-with-dependencies" title="Permalink to this headline">¶</a></h2>
<p>The fansi package was a simple one that didn’t have
dependencies. To build an R package with dependencies,
let’s look at the example of janitor. Janitor is a
package hosted on CRAN that is used for examining and
cleaning up data.</p>
<p>To begin building it, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda skeleton cran janitor
</pre></div>
</div>
<p>This creates a directory named <code class="docutils literal notranslate"><span class="pre">r-janitor</span></code> and
creates one skeleton file in that directory: <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code>.
Many other files can be added there as necessary, such
as <code class="docutils literal notranslate"><span class="pre">build.sh</span></code> and <code class="docutils literal notranslate"><span class="pre">bld.bat</span></code>, test scripts, or anything else
you need to build your software. Use the <code class="docutils literal notranslate"><span class="pre">ls</span></code> command
to verify that this file has been created. The <code class="docutils literal notranslate"><span class="pre">meta.yaml</span></code>
file has been populated with information from the CRAN
metadata and in many cases will not need to be edited.</p>
<p>Now that you have the conda-build recipe ready, you can
use conda-build to create the package:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda-build r-janitor
</pre></div>
</div>
<p>What may happen at this point is that you will have
dependencies of this package that do not exist as conda
packages yet. They need to be turned into conda packages.
Use conda skeleton to recursively build out recipes for
the packages that it depends on:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda skeleton cran janitor --recursive
</pre></div>
</div>
<p>You can manually build each package individually
by typing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda-build package-name
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Replace &quot;package-name&quot; with the name of each
package.</p>
</div>
<p>Once all of the package dependencies are resolved, you
can build the R package by using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda-build .
</pre></div>
</div>
<p>Now you can install your newly built package in your
conda environment by using the use-local flag:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda install --use-local r-janitor
</pre></div>
</div>
<p>The remaining optional sections show you how to make
R packages for other R versions and other architectures
and how to upload them to your Anaconda.org account.</p>
</div>
<div class="section" id="optional-building-for-a-different-r-version">
<span id="different-r-version"></span><h2><a class="toc-backref" href="#id6">Optional---Building for a different R version</a><a class="headerlink" href="#optional-building-for-a-different-r-version" title="Permalink to this headline">¶</a></h2>
<p>By default, conda-build creates packages for the version
of R installed in the root environment. To build packages
for other versions of R, you use the <code class="docutils literal notranslate"><span class="pre">--R</span></code> flag followed by
a version.</p>
<p>For example, to explicitly build a version of the fansi package
for R 3.6.1, use:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda-build --R <span class="m">3</span>.6.1 r-fansi
</pre></div>
</div>
<p>Notice that the file printed at the end of the conda-build
output has changed to reflect the requested version of R.
Conda install will look in the package directory for the file
that matches your current R version.</p>
<p>Example file path:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>/Users/jsmith/anaconda3/conda-bld/osx-64/r-fansi-0.4.0-r353h46e59ec_0.tar.bz2
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Your path and filename will vary depending on your
installation and operating system. Save the path and
filename information for the next task.</p>
</div>
</div>
<div class="section" id="optional-uploading-packages-to-anaconda-org">
<span id="upload-to-anaconda-org1"></span><h2><a class="toc-backref" href="#id7">Optional---Uploading packages to Anaconda.org</a><a class="headerlink" href="#optional-uploading-packages-to-anaconda-org" title="Permalink to this headline">¶</a></h2>
<p>Anaconda.org is a repository for public or private packages.
Uploading to Anaconda.org allows you to easily install your package
in any environment with just the <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span></code> command,
rather than manually copying or moving the tarball file from
one location to another. You can choose to make your files
public or private.</p>
<p>For more information about Anaconda.org, see the <a class="reference external" href="http://docs.anaconda.org/">Anaconda.org documentation</a>.</p>
<ol class="arabic simple">
<li>Create a free Anaconda.org account and record your new
Anaconda.org username and password.</li>
<li>Run <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">install</span> <span class="pre">anaconda-client</span></code> and enter your
Anaconda.org username and password.</li>
<li>Log into your Anaconda.org account from your terminal with
the command <code class="docutils literal notranslate"><span class="pre">anaconda</span> <span class="pre">login</span></code>.</li>
</ol>
<p>Now you can upload the new local packages to Anaconda.org.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>anaconda upload /Users/jsmith/anaconda3/conda-bld/osx-64/r-fansi-0.4.0-r353h46e59ec_0.tar.bz2
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Change your path and filename to the exact path and
filename you saved in <a class="reference internal" href="#different-r-version"><span class="std std-ref">Optional---Building for a different R version</span></a>. Your path and filename
will vary depending on your installation and operating system.
If you created packages for multiple versions of R,
you must use the <code class="docutils literal notranslate"><span class="pre">anaconda</span> <span class="pre">upload</span></code> command to upload each one.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If you want to always automatically upload a successful build to Anaconda.org, run:
<code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">config</span> <span class="pre">--set</span> <span class="pre">anaconda_upload</span> <span class="pre">yes</span></code></p>
</div>
<p>You can log out of your Anaconda.org account with the command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>anaconda <span class="nb">logout</span>
</pre></div>
</div>
</div>
<div class="section" id="more-information">
<h2><a class="toc-backref" href="#id8">More information</a><a class="headerlink" href="#more-information" title="Permalink to this headline">¶</a></h2>
<p>For more options, see the full
<a class="reference internal" href="../../resources/commands/conda-skeleton.html"><span class="doc">conda skeleton command documentation</span></a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../recipes/index.html" class="btn btn-neutral float-right" title="Recipes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="build-pkgs.html" class="btn btn-neutral float-left" title="Building conda packages from scratch" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Anaconda, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>