

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Debugging conda recipes &mdash; conda-build 3.19.3+96.g1f9228d.dirty documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/conda-logo.png"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Environment variables" href="../environment-variables.html" />
    <link rel="prev" title="Sample recipes" href="sample-recipes.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> conda-build
          

          
          </a>

          
            
            
              <div class="version">
                3.19.3+96.g1f9228d.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install-conda-build.html">Installing and updating conda-build</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/index.html">Concepts</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Recipes</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="build-without-recipe.html">Building a package without a recipe (bdist_conda)</a></li>
<li class="toctree-l3"><a class="reference internal" href="sample-recipes.html">Sample recipes</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Debugging conda recipes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#next-steps">Next steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="#complications-with-multiple-outputs">Complications with multiple outputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cleanup">Cleanup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#quirks">Quirks</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../environment-variables.html">Environment variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wheel-files.html">Using wheel files with conda</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../resources/index.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes.html">Release notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">conda-build</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">User guide</a> &raquo;</li>
        
          <li><a href="index.html">Recipes</a> &raquo;</li>
        
      <li>Debugging conda recipes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="debugging-conda-recipes">
<h1>Debugging conda recipes<a class="headerlink" href="#debugging-conda-recipes" title="Permalink to this headline">¶</a></h1>
<p>Recipes are something that you'll rarely get exactly right on the first try.
Something about the build will be wrong, and the build will break. Maybe you
only notice a problem during tests, but you need more info than you got from the
tests running in conda-build. Conda-build 3.17.0 added the subcommand, <code class="docutils literal notranslate"><span class="pre">conda</span>
<span class="pre">debug</span></code>, that is designed to facilitate the recipe debugging process.</p>
<p>Fundamentally, debugging is a process of getting into or recreating the
environment and set of shell environment variables that conda-build creates
during its build or test processes. This has been possible for a very long
time---you could observe the build output, figure out where the files from your
build were placed, navigate there, and finally, activate the appropriate environment(s).
Then you might also need to set some environment variables manually.</p>
<p>What <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">debug</span></code> does is to create environments for you and provide you
with a single command line that you can copy/paste to enter a debugging
environment.</p>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">debug</span></code> command accepts 1 of 2 kinds of inputs: a recipe folder or
a path to a built package.</p>
<p>If a path to a recipe folder is provided, <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">debug</span></code> creates the build and host
environments. It provisions any source code that your recipe specifies. It
leaves the build-time scripts in the work folder for you.  When complete, <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">debug</span></code> prints something like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">################################################################################</span>
Build and/or host environments created <span class="k">for</span> debugging.  To enter a debugging environment:

<span class="nb">cd</span> /Users/UserName/miniconda3/conda-bld/debug_1542385789430/work <span class="o">&amp;&amp;</span> <span class="nb">source</span> /Users/UserName/miniconda3/conda-bld/debug_1542385789430/work/build_env_setup.sh

To run your build, you might want to start with running the conda_build.sh file.
<span class="c1">################################################################################</span>
</pre></div>
</div>
<p>If a path to a built package is provided, <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">debug</span></code> creates the test
environment. It prepares any test files that the recipe specified. When complete, <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">debug</span></code> prints something like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">################################################################################</span>
Test environment created <span class="k">for</span> debugging.  To enter a debugging environment:

<span class="nb">cd</span> /Users/UserName/miniconda3/conda-bld/conda-build_1542302975704/work <span class="o">&amp;&amp;</span> <span class="nb">source</span> /Users/UserName/miniconda3/conda-bld/conda-build_1542302975704/work/build_env_setup.sh

To run your tests, you might want to start with running the conda_test_runner.sh file.
<span class="c1">################################################################################</span>
</pre></div>
</div>
</div>
<div class="section" id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h2>
<p>Given the output above, you can now enter an environment to start debugging.
Copy paste from your terminal and go:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /Users/UserName/miniconda3/conda-bld/debug_1542385789430/work <span class="o">&amp;&amp;</span> <span class="nb">source</span> /Users/UserName/miniconda3/conda-bld/debug_1542385789430/work/build_env_setup.sh
</pre></div>
</div>
<p>This is where you'll hopefully know what build commands you want to run to help
you debug. Every build is different so your experience will vary. However,
if you have no idea at all, you could probably start by running the appropriate
build or test script, as mentioned in the output. If you do this, remember that
these scripts might be written to exit on error, which may close your shell
session. It may be wise to only run these scripts in an explicit subshell:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bash conda_build.sh
bash conda_test_runner.sh
</pre></div>
</div>
</div>
<div class="section" id="complications-with-multiple-outputs">
<h2>Complications with multiple outputs<a class="headerlink" href="#complications-with-multiple-outputs" title="Permalink to this headline">¶</a></h2>
<p>Multiple outputs effectively give the recipe many build phases to consider. The
<code class="docutils literal notranslate"><span class="pre">--output-id</span></code> argument is the mechanism to specify which of these should be
used to create the debug envs and scripts. The <code class="docutils literal notranslate"><span class="pre">--output-id</span></code> argument accepts
an fnmatch pattern. You can match any part of the output filenames. This really
only works for conda packages, not other output types, such as wheels, because
conda-build can't currently predict their filenames without actually carrying
out a build.</p>
<p>For example, our <a class="reference external" href="https://github.com/AnacondaRecipes/numpy-feedstock/blob/master/recipe/meta.yaml">NumPy recipe</a> has multiple outputs.
If we wanted to debug the NumPy-base output, we would specify it with a command like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda debug numpy-feedstock --output-id<span class="o">=</span><span class="s2">&quot;numpy-base*&quot;</span>
</pre></div>
</div>
<p>If you have a matrix build, you may need to be more specific:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Specified --output-id matches more than one output <span class="o">([</span><span class="s1">&#39;/Users/msarahan/miniconda3/conda-bld/debug_1542387301945/osx-64/numpy-base-1.14.6-py27h1a60bec_4.tar.bz2&#39;</span>, <span class="s1">&#39;/Users/msarahan/miniconda3/conda-bld/debug_1542387301945/osx-64/numpy-base-1.14.6-py27h8a80b8c_4.tar.bz2&#39;</span>, <span class="s1">&#39;/Users/msarahan/miniconda3/conda-bld/debug_1542387301945/osx-64/numpy-base-1.14.6-py36h1a60bec_4.tar.bz2&#39;</span>, <span class="s1">&#39;/Users/msarahan/miniconda3/conda-bld/debug_1542387301945/osx-64/numpy-base-1.14.6-py36h8a80b8c_4.tar.bz2&#39;</span>, <span class="s1">&#39;/Users/msarahan/miniconda3/conda-bld/debug_1542387301945/osx-64/numpy-base-1.14.6-py37h1a60bec_4.tar.bz2&#39;</span>, <span class="s1">&#39;/Users/msarahan/miniconda3/conda-bld/debug_1542387301945/osx-64/numpy-base-1.14.6-py37h8a80b8c_4.tar.bz2&#39;</span><span class="o">])</span>.  Please refine your output id so that only a single output is found.
</pre></div>
</div>
<p>You could either reduce your matrix by changing your <code class="docutils literal notranslate"><span class="pre">conda_build_config.yaml</span></code>, or making a simpler one and passing it on the CLI, or by using the CLI to reduce it.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda debug numpy-feedstock --output-id<span class="o">=</span><span class="s2">&quot;numpy-base*&quot;</span> --python<span class="o">=</span><span class="m">3</span>.6 --variants<span class="o">=</span><span class="s2">&quot;{blas_impl: openblas}&quot;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Specified --output-id matches more than one output <span class="o">([</span><span class="s1">&#39;/Users/UserName/miniconda3/conda-bld/debug_1542387443190/osx-64/numpy-base-1.14.6-py36h28eea48_4.tar.bz2&#39;</span>, <span class="s1">&#39;/Users/UserName/miniconda3/conda-bld/debug_1542387443190/osx-64/numpy-base-1.14.6-py36ha711998_4.tar.bz2&#39;</span><span class="o">])</span>.  Please refine your output id so that only a single output is found.
</pre></div>
</div>
<p>However, this is still not enough as our matrix includes two BLAS implementations, MKL and OpenBLAS.</p>
<p>Further reduction:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conda debug numpy-feedstock --output-id<span class="o">=</span><span class="s2">&quot;numpy-base*&quot;</span> --python<span class="o">=</span><span class="m">3</span>.6 --variants<span class="o">=</span><span class="s2">&quot;{blas_impl: &#39;openblas&#39;}&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="cleanup">
<h2>Cleanup<a class="headerlink" href="#cleanup" title="Permalink to this headline">¶</a></h2>
<p>Debugging folders are named in a way that the <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">build</span> <span class="pre">purge</span></code> command will
find and clean up. If you use the -p/--path CLI argument, conda-build will not
detect these and you'll need to manually clean up yourself. <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">build</span>
<span class="pre">purge-all</span></code> will also remove previously built packages.</p>
</div>
<div class="section" id="quirks">
<h2>Quirks<a class="headerlink" href="#quirks" title="Permalink to this headline">¶</a></h2>
<p>You can specify where you want the root of your debugging stuff to go with the
-p/--path CLI argument. The way this works is that conda-build treats that as
its &quot;croot&quot; where packages get cached as necessary, as well as potentially
indexed. When using the --path argument, you may see folders like &quot;osx-64&quot; or
other platform subdirs in the path you specify. It is safe to remove them or
ignore them.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../environment-variables.html" class="btn btn-neutral float-right" title="Environment variables" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="sample-recipes.html" class="btn btn-neutral float-left" title="Sample recipes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Anaconda, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>